"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=431,exports.ids=[431],exports.modules={431:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ion_virtual_scroll:()=>VirtualScroll});var _Users_jeniphanpukkham_Documents_akira_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8239),_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3150),_helpers_dd7e4b7b_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2377);const updateVDom=__name((dom,heightIndex,cells,range)=>{for(const node of dom)node.change=0,node.d=!0;const toMutate=[],end=range.offset+range.length;for(let i=range.offset;i<end;i++){const cell=cells[i],node=dom.find(n=>n.d&&n.cell===cell);if(node){const top=heightIndex[i];top!==node.top&&(node.top=top,node.change=1),node.d=!1}else toMutate.push(cell)}const pool=dom.filter(n=>n.d);for(const cell of toMutate){const node=pool.find(n=>n.d&&n.cell.type===cell.type),index=cell.i;node?(node.d=!1,node.change=2,node.cell=cell,node.top=heightIndex[index]):dom.push({d:!1,cell,visible:!0,change:2,top:heightIndex[index]})}dom.filter(n=>n.d&&-9999!==n.top).forEach(n=>{n.change=1,n.top=-9999})},"updateVDom"),doRender=__name((el,nodeRender,dom,updateCellHeight)=>{const children=Array.from(el.children).filter(n=>"TEMPLATE"!==n.tagName),childrenNu=children.length;let child;for(let i=0;i<dom.length;i++){const node=dom[i],cell=node.cell;if(2===node.change){if(i<childrenNu)child=children[i],nodeRender(child,cell,i);else{const newChild=createNode(el,cell.type);child=nodeRender(newChild,cell,i)||newChild,child.classList.add("virtual-item"),el.appendChild(child)}child.$ionCell=cell}else child=children[i];0!==node.change&&(child.style.transform=`translate3d(0,${node.top}px,0)`);const visible=cell.visible;node.visible!==visible&&(visible?child.classList.remove("virtual-loading"):child.classList.add("virtual-loading"),node.visible=visible),cell.reads>0&&(updateCellHeight(cell,child),cell.reads--)}},"doRender"),createNode=__name((el,type)=>{const template=getTemplate(el,type);return template&&el.ownerDocument?el.ownerDocument.importNode(template.content,!0).children[0]:null},"createNode"),getTemplate=__name((el,type)=>{switch(type){case"item":return el.querySelector("template:not([name])");case"header":return el.querySelector("template[name=header]");case"footer":return el.querySelector("template[name=footer]")}},"getTemplate"),getViewport=__name((scrollTop,vierportHeight,margin)=>({top:Math.max(scrollTop-margin,0),bottom:scrollTop+vierportHeight+margin}),"getViewport"),getRange=__name((heightIndex,viewport,buffer)=>{const topPos=viewport.top,bottomPos=viewport.bottom;let i=0;for(;i<heightIndex.length&&!(heightIndex[i]>topPos);i++);const offset=Math.max(i-buffer-1,0);for(;i<heightIndex.length&&!(heightIndex[i]>=bottomPos);i++);return{offset,length:Math.min(i+buffer,heightIndex.length)-offset}},"getRange"),getShouldUpdate=__name((dirtyIndex,currentRange,range)=>dirtyIndex<=range.offset+range.length||currentRange.offset!==range.offset||currentRange.length!==range.length,"getShouldUpdate"),findCellIndex=__name((cells,index)=>{const max=cells.length>0?cells[cells.length-1].index:0;return 0===index?0:index===max+1?cells.length:cells.findIndex(c=>c.index===index)},"findCellIndex"),inplaceUpdate=__name((dst,src,offset)=>{if(0===offset&&src.length>=dst.length)return src;for(let i=0;i<src.length;i++)dst[i+offset]=src[i];return dst},"inplaceUpdate"),calcCells=__name((items,itemHeight,headerHeight,footerHeight,headerFn,footerFn,approxHeaderHeight,approxFooterHeight,approxItemHeight,j,offset,len)=>{const cells=[],end=len+offset;for(let i=offset;i<end;i++){const item=items[i];if(headerFn){const value=headerFn(item,i,items);null!=value&&cells.push({i:j++,type:"header",value,index:i,height:headerHeight?headerHeight(value,i):approxHeaderHeight,reads:headerHeight?0:2,visible:!!headerHeight})}if(cells.push({i:j++,type:"item",value:item,index:i,height:itemHeight?itemHeight(item,i):approxItemHeight,reads:itemHeight?0:2,visible:!!itemHeight}),footerFn){const value=footerFn(item,i,items);null!=value&&cells.push({i:j++,type:"footer",value,index:i,height:footerHeight?footerHeight(value,i):approxFooterHeight,reads:footerHeight?0:2,visible:!!footerHeight})}}return cells},"calcCells"),calcHeightIndex=__name((buf,cells,index)=>{let acum=buf[index];for(let i=index;i<buf.length;i++)buf[i]=acum,acum+=cells[i].height;return acum},"calcHeightIndex"),resizeBuffer=__name((buf,len)=>{if(!buf)return new Uint32Array(len);if(buf.length===len)return buf;if(len>buf.length){const newBuf=new Uint32Array(len);return newBuf.set(buf),newBuf}return buf.subarray(0,len)},"resizeBuffer"),positionForIndex=__name((index,cells,heightIndex)=>{const cell=cells.find(c=>"item"===c.type&&c.index===index);return cell?heightIndex[cell.i]:-1},"positionForIndex"),VirtualScroll=__name(class{constructor(hostRef){(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.r)(this,hostRef),this.range={offset:0,length:0},this.viewportHeight=0,this.cells=[],this.virtualDom=[],this.isEnabled=!1,this.viewportOffset=0,this.currentScrollTop=0,this.indexDirty=0,this.lastItemLen=0,this.totalHeight=0,this.approxItemHeight=45,this.approxHeaderHeight=30,this.approxFooterHeight=30,this.onScroll=()=>{this.updateVirtualScroll()}}itemsChanged(){this.calcCells(),this.updateVirtualScroll()}componentWillLoad(){console.warn("[Deprecation Warning]: ion-virtual-scroll has been deprecated and will be removed in Ionic Framework v7.0. See https://ionicframework.com/docs/angular/virtual-scroll for migration steps.")}connectedCallback(){var _this=this;return(0,_Users_jeniphanpukkham_Documents_akira_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.Z)(function*(){const contentEl=_this.el.closest("ion-content");contentEl?(_this.scrollEl=yield contentEl.getScrollElement(),_this.contentEl=contentEl,_this.calcCells(),_this.updateState()):console.error("<ion-virtual-scroll> must be used inside an <ion-content>")})()}componentDidUpdate(){this.updateState()}disconnectedCallback(){this.scrollEl=void 0}onResize(){this.calcCells(),this.updateVirtualScroll()}positionForItem(index){return Promise.resolve(positionForIndex(index,this.cells,this.getHeightIndex()))}checkRange(offset,len=-1){var _this2=this;return(0,_Users_jeniphanpukkham_Documents_akira_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.Z)(function*(){if(!_this2.items)return;const length=-1===len?_this2.items.length-offset:len,cellIndex=findCellIndex(_this2.cells,offset),cells=calcCells(_this2.items,_this2.itemHeight,_this2.headerHeight,_this2.footerHeight,_this2.headerFn,_this2.footerFn,_this2.approxHeaderHeight,_this2.approxFooterHeight,_this2.approxItemHeight,cellIndex,offset,length);_this2.cells=inplaceUpdate(_this2.cells,cells,cellIndex),_this2.lastItemLen=_this2.items.length,_this2.indexDirty=Math.max(offset-1,0),_this2.scheduleUpdate()})()}checkEnd(){var _this3=this;return(0,_Users_jeniphanpukkham_Documents_akira_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.Z)(function*(){_this3.items&&_this3.checkRange(_this3.lastItemLen)})()}updateVirtualScroll(){!this.isEnabled||!this.scrollEl||(this.timerUpdate&&(clearTimeout(this.timerUpdate),this.timerUpdate=void 0),(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.f)(this.readVS.bind(this)),(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.c)(this.writeVS.bind(this)))}readVS(){const{contentEl,scrollEl,el}=this;let topOffset=0,node=el;for(;node&&node!==contentEl;)topOffset+=node.offsetTop,node=node.offsetParent;this.viewportOffset=topOffset,scrollEl&&(this.viewportHeight=scrollEl.offsetHeight,this.currentScrollTop=scrollEl.scrollTop)}writeVS(){const dirtyIndex=this.indexDirty,scrollTop=this.currentScrollTop-this.viewportOffset,viewport=getViewport(scrollTop,this.viewportHeight,100),heightIndex=this.getHeightIndex(),range=getRange(heightIndex,viewport,2);!getShouldUpdate(dirtyIndex,this.range,range)||(this.range=range,updateVDom(this.virtualDom,heightIndex,this.cells,range),this.nodeRender?doRender(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this)):this.domRender?this.domRender(this.virtualDom):this.renderItem&&(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.j)(this))}updateCellHeight(cell,node){const update=__name(()=>{if(node.$ionCell===cell){const style=window.getComputedStyle(node),height=node.offsetHeight+parseFloat(style.getPropertyValue("margin-bottom"));this.setCellHeight(cell,height)}},"update");node?(0,_helpers_dd7e4b7b_js__WEBPACK_IMPORTED_MODULE_2__.c)(node,update):update()}setCellHeight(cell,height){const index=cell.i;cell===this.cells[index]&&(cell.height!==height||!0!==cell.visible)&&(cell.visible=!0,cell.height=height,this.indexDirty=Math.min(this.indexDirty,index),this.scheduleUpdate())}scheduleUpdate(){clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout(()=>this.updateVirtualScroll(),100)}updateState(){const shouldEnable=!(!this.scrollEl||!this.cells);shouldEnable!==this.isEnabled&&(this.enableScrollEvents(shouldEnable),shouldEnable&&this.updateVirtualScroll())}calcCells(){!this.items||(this.lastItemLen=this.items.length,this.cells=calcCells(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen),this.indexDirty=0)}getHeightIndex(){return this.indexDirty!==1/0&&this.calcHeightIndex(this.indexDirty),this.heightIndex}calcHeightIndex(index=0){this.heightIndex=resizeBuffer(this.heightIndex,this.cells.length),this.totalHeight=calcHeightIndex(this.heightIndex,this.cells,index),this.indexDirty=1/0}enableScrollEvents(shouldListen){this.rmEvent&&(this.rmEvent(),this.rmEvent=void 0);const scrollEl=this.scrollEl;scrollEl&&(this.isEnabled=shouldListen,scrollEl.addEventListener("scroll",this.onScroll),this.rmEvent=()=>{scrollEl.removeEventListener("scroll",this.onScroll)})}renderVirtualNode(node){const{type,value,index}=node.cell;switch(type){case"item":return this.renderItem(value,index);case"header":return this.renderHeader(value,index);case"footer":return this.renderFooter(value,index)}}render(){return(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.H,{style:{height:`${this.totalHeight}px`}},this.renderItem&&(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.h)(VirtualProxy,{dom:this.virtualDom},this.virtualDom.map(node=>this.renderVirtualNode(node))))}get el(){return(0,_index_7a8b7a1c_js__WEBPACK_IMPORTED_MODULE_0__.i)(this)}static get watchers(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}}},"VirtualScroll"),VirtualProxy=__name(({dom},children,utils)=>utils.map(children,(child,i)=>{const node=dom[i],vattrs=child.vattrs||{};let classes=vattrs.class||"";return classes+="virtual-item ",node.visible||(classes+="virtual-loading"),Object.assign(Object.assign({},child),{vattrs:Object.assign(Object.assign({},vattrs),{class:classes,style:Object.assign(Object.assign({},vattrs.style),{transform:`translate3d(0,${node.top}px,0)`})})})}),"VirtualProxy");VirtualScroll.style="ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute !important;top:0 !important;right:0 !important;left:0 !important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}"}};